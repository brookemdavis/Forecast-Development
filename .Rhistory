FitsDF$CI_low <- R_Ests$R_Fit - 1.96*R_Ests$StdErr
FitsDF$CI_up <- R_Ests$R_Fit + 1.96*R_Ests$StdErr
# create prediction interval using simulate
R_Preds <- matrix(nrow = 1000, ncol = 50)
for(i in 1:1000){
R_Preds[i, ] <- obj$simulate()$R_Pred
}
R_Pred_Summ <- apply(R_Preds, 2, quantile, probs = c(0.025, 0.5, 0.975))
FitsDF$Pred <- R_Pred_Summ[2,]
FitsDF$Pred_low <- R_Pred_Summ[1,]
FitsDF$Pred_up<- R_Pred_Summ[3,]
FitsDF <- data.frame(S = data$S, R = data$R, Fit = R_Ests_Jags$X50. ,
Year = 1:dim(R_Ests_Jags)[1],
CI_up = R_Ests_Jags$X97.5.,
CI_low = R_Ests_Jags$X2.5.)
# create new rows with fitted values
FitsDF_TMB <- data.frame(S = Data$S, R = NA, Fit = R_Ests$R_Fit, Year = 1:dim(R_Ests)[1],
Mod = "TMB_No_Prior")
FitsDF_TMB$CI_low <- R_Ests$R_Fit - 1.96*R_Ests$StdErr
FitsDF_TMB$CI_up <- R_Ests$R_Fit + 1.96*R_Ests$StdErr
FitsDF_TMB$Pred <- R_Pred_Summ[2,]
FitsDF_TMB$Pred_low <- R_Pred_Summ[1,]
FitsDF_TMB$Pred_up<- R_Pred_Summ[3,]
head(FitsDF)
head(FitsDF_TMB)
All_Ests <- bind_rows(FitsDF, FitsDF_TMB)
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
theme_bw()
TMB_No_Prior <- RunPower(Data = SimDataDF,
Fitting_SW = "TMB",
Priors = F, Name = "TMB_No_Prior")
source("Code/Functions.R")
TMB_No_Prior <- RunPower(Data = SimDataDF,
Fitting_SW = "TMB",
Priors = F, Name = "TMB_No_Prior")
# only need to compile if changed model
# dyn.unload(dynlib("Code/TMB/Single_Stock_Power"))
# TMB::compile("Code/TMB/Single_Stock_Power.cpp") # can't seem to compile if have TMBstan loaded
dyn.load(dynlib("Code/TMB/Single_Stock_Power"))
TMB_No_Prior <- RunPower(Data = SimDataDF,
Fitting_SW = "TMB",
Priors = F, Name = "TMB_No_Prior")
source("Code/Functions.R")
TMB_No_Prior <- RunPower(Data = SimDataDF,
Fitting_SW = "TMB",
Priors = F, Name = "TMB_No_Prior")
SimData$true_a
SimData
# Now run with priors same as "true" values
TMB_True_Prior <- RunRicker(Data = SimDataDF,  Fitting_SW = "TMB",
Priors = T, Name = "TMB_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
# Now run with priors same as "true" values
TMB_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "TMB",
Priors = T, Name = "TMB_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
All_Ests <- bind_rows(DataDF, TMB_No_Prior[[1]], TMB_True_Prior[[1]])
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
head(DataDF)
DataDF <- SimDataDF[, c("S", "R", "Year")]
DataDF$Fit <- exp(SimData$true_a + SimData$true_b*DataDF$S)
DataDF$Mod <- "True"
DataDF$CI_low <- DataDF$CI_up  <-  DataDF$Pred <- DataDF$Pred_low <- DataDF$Pred_up <- DataDF$Fit
All_Ests <- bind_rows(DataDF, TMB_No_Prior[[1]], TMB_True_Prior[[1]])
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
All_Ests <- DataDF
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
# Create DF to store true and fitted values
DataDF <- SimDataDF[, c("S", "R", "Year")]
DataDF$Fit <- exp(SimData$true_a + SimData$true_b*DataDF$S)
DataDF$Mod <- "True"
DataDF$CI_low <- DataDF$CI_up  <-  DataDF$Pred <- DataDF$Pred_low <- DataDF$Pred_up <- DataDF$Fit
head(DataDF)
# Create DF to store true and fitted values
DataDF <- SimDataDF[, c("S", "R", "Year")]
DataDF$Fit <- exp(SimData$true_a + SimData$true_b*log(DataDF$S))
DataDF$Mod <- "True"
DataDF$CI_low <- DataDF$CI_up  <-  DataDF$Pred <- DataDF$Pred_low <- DataDF$Pred_up <- DataDF$Fit
All_Ests <- DataDF
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
All_Ests <- bind_rows(DataDF, TMB_No_Prior[[1]], TMB_True_Prior[[1]])
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
tmbstan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "tmbstan",
Priors = T,  Name = "tmbstan_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
All_Ests <- bind_rows(DataDF, TMB_No_Prior[[1]], TMB_True_Prior[[1]], tmbstan_True_Prior[[1]])
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
JAGS_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "JAGS",
Priors = T,  Name = "JAGS_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
JAGS_True_Prior[[1]]
# Fit using Stan
Stan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "Stan",
Priors = T,   Name = "Stan_True_Prior",
logA_mean = log(SimData$true_a),
logA_sig = 0.5,
Smax_mean = 1/SimData$true_b,
Smax_sig = 1/SimData$true_b/4)
# Fit using Stan
Stan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "Stan",
Priors = T,   Name = "Stan_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
source("Code/Functions.R")
# Fit using Stan
Stan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "Stan",
Priors = T,   Name = "Stan_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
# Fit using Stan
Stan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "Stan",
Priors = T,   Name = "Stan_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
All_Ests <- bind_rows(DataDF, TMB_No_Prior[[1]], TMB_True_Prior[[1]], tmbstan_True_Prior[[1]],
JAGS_True_Prior[[1]], Stan_True_Prior[[1]])
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
All_Ests <- bind_rows(DataDF, TMB_No_Prior[[1]], TMB_True_Prior[[1]], tmbstan_True_Prior[[1]],
JAGS_True_Prior[[1]])#, Stan_True_Prior[[1]])
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
# Fit using Stan
Stan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "Stan",
Priors = T,   Name = "Stan_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
All_Ests <- bind_rows(DataDF, TMB_No_Prior[[1]], TMB_True_Prior[[1]], tmbstan_True_Prior[[1]],
JAGS_True_Prior[[1]]), Stan_True_Prior[[1]])
All_Ests <- bind_rows(DataDF, TMB_No_Prior[[1]], TMB_True_Prior[[1]], tmbstan_True_Prior[[1]],
JAGS_True_Prior[[1]], Stan_True_Prior[[1]])
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
SimData <- Sim_Power_SR_Data(leng=50, age=4, Sig_Mod = 0.3, true_a = 6, true_b=0.5,
hr_min = 0.2, hr_max = 0.8, lnorm_corr = F, max_pop = 100000)
SimDataDF <- data.frame(S = round(SimData$S), R = (SimData$R), Year = 1:length(SimData$S))
ggplot(SimDataDF, aes(x=S, y=R)) + geom_point() + coord_fixed()
# Create DF to store true and fitted values
DataDF <- SimDataDF[, c("S", "R", "Year")]
DataDF$Fit <- exp(SimData$true_a + SimData$true_b*log(DataDF$S))
DataDF$Mod <- "True"
DataDF$CI_low <- DataDF$CI_up  <-  DataDF$Pred <- DataDF$Pred_low <- DataDF$Pred_up <- DataDF$Fit
# run using TMB, without prior
# only need to compile if changed model
# dyn.unload(dynlib("Code/TMB/Single_Stock_Power"))
# TMB::compile("Code/TMB/Single_Stock_Power.cpp") # can't seem to compile if have TMBstan loaded
dyn.load(dynlib("Code/TMB/Single_Stock_Power"))
TMB_No_Prior <- RunPower(Data = SimDataDF,
Fitting_SW = "TMB",
Priors = F, Name = "TMB_No_Prior")
# Now run with priors same as "true" values
TMB_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "TMB",
Priors = T, Name = "TMB_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
# Run same model as mcmc using tmbstan
library(tmbstan)
tmbstan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "tmbstan",
Priors = T,  Name = "tmbstan_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
# Fit using JAGS
library(R2jags)
JAGS_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "JAGS",
Priors = T,  Name = "JAGS_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
# Fit using Stan
Stan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "Stan",
Priors = T,   Name = "Stan_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
All_Ests <- bind_rows(DataDF, TMB_No_Prior[[1]], TMB_True_Prior[[1]], tmbstan_True_Prior[[1]],
JAGS_True_Prior[[1]], Stan_True_Prior[[1]])
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
SimData
SimData <- Sim_Power_SR_Data(leng=50, age=4, Sig_Mod = 0.3, true_a = 6, true_b=0.5,
hr_min = 0.2, hr_max = 0.8, lnorm_corr = F, max_pop = 100000)
SimDataDF <- data.frame(S = round(SimData$S), R = (SimData$R), Year = 1:length(SimData$S))
ggplot(SimDataDF, aes(x=S, y=R)) + geom_point() + coord_fixed()
DataDF <- SimDataDF[, c("S", "R", "Year")]
DataDF$Fit <- exp(SimData$true_a + SimData$true_b*log(DataDF$S))
DataDF$Mod <- "True"
DataDF$CI_low <- DataDF$CI_up  <-  DataDF$Pred <- DataDF$Pred_low <- DataDF$Pred_up <- DataDF$Fit
# run using TMB, without prior
TMB_No_Prior <- RunPower(Data = SimDataDF,
Fitting_SW = "TMB",
Priors = F, Name = "TMB_No_Prior")
# Now run with priors same as "true" values
TMB_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "TMB",
Priors = T, Name = "TMB_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
# Run same model as mcmc using tmbstan
library(tmbstan)
tmbstan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "tmbstan",
Priors = T,  Name = "tmbstan_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
# Fit using JAGS
library(R2jags)
JAGS_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "JAGS",
Priors = T,  Name = "JAGS_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
# Fit using Stan
Stan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "Stan",
Priors = T,   Name = "Stan_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.5,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
All_Ests <- bind_rows(DataDF, TMB_No_Prior[[1]], TMB_True_Prior[[1]], tmbstan_True_Prior[[1]],
JAGS_True_Prior[[1]], Stan_True_Prior[[1]])
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
# Now run with priors same as "true" values
TMB_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "TMB",
Priors = T, Name = "TMB_True_Prior",
A_mean = SimData$true_a,
A_sig = SimData$true_a/4,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
tmbstan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "tmbstan",
Priors = T,  Name = "tmbstan_True_Prior",
A_mean = SimData$true_a,
A_sig =SimData$true_a/4,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
All_Ests <- bind_rows(DataDF, TMB_No_Prior[[1]], TMB_True_Prior[[1]], tmbstan_True_Prior[[1]],
JAGS_True_Prior[[1]], Stan_True_Prior[[1]])
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
log(0.5)
log(6)
log(-2)
exp(1)
source("Code/Functions.R")
tmbstan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "tmbstan",
Priors = T,  Name = "tmbstan_True_Prior",
A_mean = SimData$true_a,
A_sig =SimData$true_a/4,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
Bayes
data
TMB_No_Prior <- RunPower(Data = SimDataDF,
Fitting_SW = "TMB",
Priors = F, Name = "TMB_No_Prior")
# Now run with priors same as "true" values
TMB_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "TMB",
Priors = T, Name = "TMB_True_Prior",
A_mean = SimData$true_a,
A_sig = SimData$true_a/4,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
TMB_No_Prior <- RunPower(Data = SimDataDF,
Fitting_SW = "TMB",
Priors = F, Name = "TMB_No_Prior")
# Now run with priors same as "true" values
TMB_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "TMB",
Priors = T, Name = "TMB_True_Prior",
A_mean = SimData$true_a,
A_sig = SimData$true_a/4,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
tmbstan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "tmbstan",
Priors = T,  Name = "tmbstan_True_Prior",
A_mean = SimData$true_a,
A_sig =SimData$true_a/4,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
source("Code/Functions.R")
TMB_No_Prior <- RunPower(Data = SimDataDF,
Fitting_SW = "TMB",
Priors = F, Name = "TMB_No_Prior")
# Now run with priors same as "true" values
TMB_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "TMB",
Priors = T, Name = "TMB_True_Prior",
A_mean = SimData$true_a,
A_sig = SimData$true_a/4,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
tmbstan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "tmbstan",
Priors = T,  Name = "tmbstan_True_Prior",
A_mean = SimData$true_a,
A_sig =SimData$true_a/4,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
All_Ests <- bind_rows(DataDF, TMB_No_Prior[[1]], TMB_True_Prior[[1]], tmbstan_True_Prior[[1]],
JAGS_True_Prior[[1]], Stan_True_Prior[[1]])
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
Stan_True_Prior[[3]]
str(Stan_True_Prior)
str(Stan_True_Prior[[2]])
Stan_True_Prior[[2]]
SimData$true_a
SimData$true_b
TMB_No_Prior[[2]]
SimData$true_a/4
# Now run with priors same as "true" values
TMB_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "TMB",
Priors = T, Name = "TMB_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.1,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
All_Ests <- bind_rows(DataDF, TMB_No_Prior[[1]], TMB_True_Prior[[1]], tmbstan_True_Prior[[1]],
JAGS_True_Prior[[1]], Stan_True_Prior[[1]])
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
# Now run with priors same as "true" values
TMB_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "TMB",
Priors = T, Name = "TMB_True_Prior",
A_mean = SimData$true_a,
A_sig = 0.2,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
All_Ests <- bind_rows(DataDF, TMB_No_Prior[[1]], TMB_True_Prior[[1]], tmbstan_True_Prior[[1]],
JAGS_True_Prior[[1]], Stan_True_Prior[[1]])
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
JAGS_True_Prior[[2]]
SimData <- Sim_Power_SR_Data(leng=50, age=4, Sig_Mod = 0.1, true_a = 6, true_b=0.5,
hr_min = 0.2, hr_max = 0.8, lnorm_corr = F, max_pop = 100000)
SimDataDF <- data.frame(S = round(SimData$S), R = (SimData$R), Year = 1:length(SimData$S))
ggplot(SimDataDF, aes(x=S, y=R)) + geom_point() + coord_fixed()
# Create DF to store true and fitted values
DataDF <- SimDataDF[, c("S", "R", "Year")]
DataDF$Fit <- exp(SimData$true_a + SimData$true_b*log(DataDF$S))
DataDF$Mod <- "True"
DataDF$CI_low <- DataDF$CI_up  <-  DataDF$Pred <- DataDF$Pred_low <- DataDF$Pred_up <- DataDF$Fit
TMB_No_Prior <- RunPower(Data = SimDataDF,
Fitting_SW = "TMB",
Priors = F, Name = "TMB_No_Prior")
# Now run with priors same as "true" values
TMB_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "TMB",
Priors = T, Name = "TMB_True_Prior",
A_mean = SimData$true_a,
A_sig = SimData$true_a/4,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
# Run same model as mcmc using tmbstan
library(tmbstan)
tmbstan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "tmbstan",
Priors = T,  Name = "tmbstan_True_Prior",
A_mean = SimData$true_a,
A_sig =SimData$true_a/4,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
JAGS_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "JAGS",
Priors = T,  Name = "JAGS_True_Prior",
A_mean = SimData$true_a,
A_sig = SimData$true_a/4,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
# Fit using Stan
Stan_True_Prior <- RunPower(Data = SimDataDF,  Fitting_SW = "Stan",
Priors = T,   Name = "Stan_True_Prior",
A_mean = SimData$true_a,
A_sig = SimData$true_a/4,
B_mean = SimData$true_b,
B_sig = SimData$true_b/4)
All_Ests <- bind_rows(DataDF, TMB_No_Prior[[1]], TMB_True_Prior[[1]], tmbstan_True_Prior[[1]],
JAGS_True_Prior[[1]], Stan_True_Prior[[1]])
# Now plot all to compare
ggplot(data = All_Ests, aes(x=S, y=Fit, ymin = CI_low, ymax = CI_up, col = Mod, fill= Mod)) +
geom_line(size = 1.5) +
geom_ribbon( alpha = 0.1) +
geom_point(aes(x=S, y=R), col = "black") +
geom_ribbon(aes(x=S, y=Pred, ymin = Pred_low, ymax = Pred_up, fill= Mod),
alpha = 0.05) +
theme_bw()
TMB_No_Prior[[1]]
TMB_No_Prior[[2]]
exp(1.4)
exp(1.7)
